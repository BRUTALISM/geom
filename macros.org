#+SEQ_TODO:       TODO(t) INPROGRESS(i) WAITING(w@) | DONE(d) CANCELED(c@)
#+TAGS:           Write(w) Update(u) Fix(f) Check(c) noexport(n)
#+EXPORT_EXCLUDE_TAGS: noexport

* Helper macros
** Matrix item calculation
#+BEGIN_SRC clojure :noweb-ref mat-ops  
  (defmacro madd
    ([a b c]
       `(+ (* ~a ~b) ~c))
    ([a b c d]
       `(+ (* ~a ~b) (* ~c ~d)))
    ([a b c d e]
       `(+ (+ (* ~a ~b) (* ~c ~d)) ~e))
    ([a b c d e f]
       `(+ (+ (* ~a ~b) (* ~c ~d)) (* ~e ~f)))
    ([a b c d e f g]
       `(+ (+ (+ (* ~a ~b) (* ~c ~d)) (* ~e ~f)) ~g))
    ([a b c d e f g h]
       `(+ (+ (+ (* ~a ~b) (* ~c ~d)) (* ~e ~f)) (* ~g ~h))))
  
  (defmacro msub
    ([a b c] `(- (* ~a ~b) ~c))
    ([a b c d] `(- (* ~a ~b) (* ~c ~d)))
    ([a b c d e f] `(- (- (* ~a ~b) (* ~c ~d)) (* ~e ~f)))
    ([a b c d e f g h] `(- (- (- (* ~a ~b) (* ~c ~d)) (* ~e ~f)) (* ~g ~h))))
  
  (defmacro maddsub
    ([a b c d e f]
       `(- (+ (* ~a ~b) (* ~c ~d)) (* ~e ~f)))
    ([a b c d e f g h]
       `(- (+ (+ (* ~a ~b) (* ~c ~d)) (* ~e ~f)) (* ~g ~h))))
  
  (defmacro addm
    ([a b c]
       `(* (+ ~a ~b) ~c)))
  
  (defmacro subm
    ([a b c]
       `(* (- ~a ~b) ~c)))
  
  (defmacro det-item
    [a b c d, e f g h, i j k l, m n o p]
    `(+
      (-
       (-
        (* (* ~a ~b) (* ~c ~d))
        (* (* ~e ~f) (* ~g ~h)))
       (* (* ~i ~j) (* ~k ~l)))
      (* (* ~m ~n) (* ~o ~p))))
  
  (defmacro inv-item
    [a b c d e f g]
    `(* (+ (- (* ~a ~b) (* ~c ~d)) (* ~e ~f)) ~g))
  ;;(* (madd e f (msub a b c d)) g)
#+END_SRC
** Voxel test
#+BEGIN_SRC clojure :noweb-ref voxel-ops
  (defmacro set-bit-if-index
    [voxels idx mask id]
    `(if (~voxels ~idx) ~id (bit-or ~id ~mask)))
#+END_SRC
** Tangle for CLJ & CLJS                                     :noexport:
#+BEGIN_SRC clojure :tangle babel/src/cljx/thi/ng/geom/macros/core.clj :noweb yes :mkdirp yes :padline no
  (ns thi.ng.geom.macros.core)
  
  <<mat-ops>>
#+END_SRC
#+BEGIN_SRC clojure :tangle babel/src/cljx/thi/ng/geom/macros/voxel.clj :noweb yes :mkdirp yes :padline no
  (ns thi.ng.geom.macros.voxel)
  
  <<voxel-ops>>
#+END_SRC
